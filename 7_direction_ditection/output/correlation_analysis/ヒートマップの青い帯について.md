# ヒートマップ（ψ）の「青い帯」について

## 現象

ψ（XZ平面）の相関ヒートマップで、**横方向・縦方向に青い帯**（負の相関が並んだ行・列）が見える。

## 正体

その帯は **LEFT_HIP の行と列** である。

- 相関行列では「関節 A の行 × 関節 B の列 = A と B の相関係数」。
- LEFT_HIP は **他 11 関節すべて** と負の相関（青）を持っている（論文で報告している LEFT_HIP–RIGHT_HIP の r = -0.84 を含む）。
- そのため、LEFT_HIP の「行」が横一列青く、LEFT_HIP の「列」が縦一列青く見え、**十字状の青い帯**になる。

## 純粋な結果か、ミスか

- **計算ロジック**: `(frame_id, camera)` を1観測として、各関節の `delta_psi_deg` の列同士の Pearson 相関を取っているだけ。符号の反転や軸の取り違えはしていない。
- **検証**: `scripts/validate_correlation_psi.py` を実行すると、
  - 生データから相関行列を再計算
  - 対角が 1・対称であることの確認
  - LEFT_HIP–RIGHT_HIP を `np.corrcoef` で手計算して一致確認
  - 保存済み `correlation_matrix_psi.csv` との一致確認  
  ができる。
- 検証で全て一致すれば、**青い帯は実装ミスではなく、データ上のパターン**（MediaPipe の腰の奥行き誤差が他関節と逆向きに現れている）と解釈できる。

## 深い意味の解釈

「腰（LEFT_HIP）が他すべての関節と負の相関」というパターンは、**MediaPipe の推定構造**を強く反映していると考えられる。

1. **腰をルートとした相対座標**  
   本研究では腰中心の相対座標で ψ を定義している。MediaPipe 側でも骨盤・腰を基準に体幹や四肢を推定しているとすると、**腰の奥行き（ψ）の推定が一方向にずれたとき、相対的な「体の向き」が反対方向にずれたように見える**。つまり「腰が前へ出た」推定誤差は、他関節の相対方向を「後ろへ」ずらすことに対応し、相関が負になる。

2. **骨盤の 1 自由度の誤りが全身に効く**  
   左右の腰（LEFT_HIP–RIGHT_HIP）が r = -0.84 で強く負の相関なのは、骨盤の奥行き回転を過大に推定しているため、と論文で述べている。その**同じ 1 つの自由度（骨盤の ψ 回転）の誤り**が、腰を基準にした相対座標では「LEFT_HIP の ψ がプラスに振れるとき、他関節の ψ がまとめてマイナスに振れる」という形で現れ、LEFT_HIP の行・列が一様に青く（負に）なる。

3. **単眼奥行きのトレードオフ**  
   単眼カメラでは奥行きが一意に決まらない。モデルは「腰を手前に取るか、遠くに取るか」のような**全体の奥行きの割り振り**をしている可能性がある。その結果、腰の ψ が一方にずれると、肩・肘・手首・膝・足首などの相対的な ψ がまとめて逆方向にずれ、腰だけが「他すべてと負の相関」というパターンとして表れうる。

まとめると、青い帯は**「腰の奥行き誤差が、相対座標系のなかで全身の方向と 1 対 1 で逆向きに現れている」**という、モデルと評価の両方の構造から自然に説明できるパターンであり、今後の補正やモデル解釈の手がかりになる。

## 実行例

```bash
cd 7_direction_ditection
python scripts/validate_correlation_psi.py
```

「結論: 計算・保存ともに一致。青い帯は…実装ミスではない。」と出れば、そのまま結果として扱ってよい。
