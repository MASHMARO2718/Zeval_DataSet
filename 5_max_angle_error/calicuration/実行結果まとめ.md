# 最大角度誤差計算スクリプト 実行結果まとめ

## 概要
MediaPipeとGround Truthの角度比較において、各カメラ座標における**最大誤差**を計算するスクリプトを作成・実行しました。

## スクリプト情報

### ファイル名
- **旧**: `max_angle_error.py`
- **新**: `calculate_max_angle_error.py`

### 主な変更点
1. 誤差計算を **MAE（平均絶対誤差）** から **最大誤差** に変更
   - `np.mean(errors)` → `np.max(errors)`
2. ログファイル名を変更
   - `coordinate_angle_comparison.log` → `max_angle_error_calculation.log`
3. デフォルト出力ファイル名を変更
   - `coordinate_angle_mae.csv` → `coordinate_max_angle_error.csv`
4. 結果表示メッセージを「MAE」から「最大誤差」に更新

---

## 実行コマンド

### Y=0.5,1.5 ディレクトリ

```bash
cd "C:\projects\MOTIONTRACK\Zeval_DataSet\5_max_angle_error\Y=0.5,1.5"

python calculate_max_angle_error.py \
  --mp_csv "CapturedFrames_*.csv" \
  --gt_csv "..\..\synced_joint_positions.csv" \
  --output_csv "coordinate_max_angle_error.csv"
```

**実行日時**: 2026-01-01 22:46

**処理座標数**: 288座標

### Y=1.0.2.0 ディレクトリ

```bash
cd "C:\projects\MOTIONTRACK\Zeval_DataSet\5_max_angle_error\Y=1.0.2.0"

python calculate_max_angle_error.py \
  --mp_csv "CapturedFrames_*.csv" \
  --gt_csv "..\..\synced_joint_positions.csv" \
  --output_csv "coordinate_max_angle_error.csv"
```

**実行日時**: 2026-01-01 23:08

**処理座標数**: 288座標

---

## 実行結果

### Y=0.5,1.5 ディレクトリの結果

| 関節 | 最大誤差の平均 | 最小値 | 最大値 |
|------|----------------|--------|--------|
| L_Elbow（左肘） | 37.35° | 4.48° | 140.13° |
| R_Elbow（右肘） | 33.80° | 0.61° | 97.25° |
| L_Knee（左膝） | 46.99° | 3.15° | 91.93° |
| R_Knee（右膝） | 49.42° | 5.35° | 77.89° |
| L_Shoulder（左肩） | 54.41° | 33.00° | 118.18° |
| R_Shoulder（右肩） | 52.07° | 24.61° | 101.90° |
| L_Hip（左股関節） | 55.34° | 1.06° | 99.72° |
| R_Hip（右股関節） | 58.07° | 9.08° | 95.98° |

**カメラ座標範囲**:
- X: -6.0 ～ 6.0
- Y: 0.5 ～ 1.5
- Z: -6.0 ～ 6.0

### Y=1.0.2.0 ディレクトリの結果

| 関節 | 最大誤差の平均 | 最小値 | 最大値 |
|------|----------------|--------|--------|
| L_Elbow（左肘） | 37.29° | 1.73° | 76.09° |
| R_Elbow（右肘） | 34.91° | 3.40° | 119.51° |
| L_Knee（左膝） | 48.95° | 0.82° | 108.26° |
| R_Knee（右膝） | 51.57° | 0.70° | 142.61° |
| L_Shoulder（左肩） | 52.42° | 29.77° | 113.87° |
| R_Shoulder（右肩） | 51.94° | 32.93° | 110.36° |
| L_Hip（左股関節） | 57.78° | 5.74° | 97.25° |
| R_Hip（右股関節） | 61.36° | 1.49° | 103.91° |

**カメラ座標範囲**:
- X: -6.0 ～ 6.0
- Y: 1.0 ～ 2.0
- Z: -6.0 ～ 6.0

---

## 2つのディレクトリの比較

| 関節 | Y=0.5,1.5 | Y=1.0.2.0 | 差分 | 傾向 |
|------|-----------|-----------|------|------|
| L_Elbow | 37.35° | 37.29° | -0.06° | ほぼ同等 |
| R_Elbow | 33.80° | 34.91° | +1.11° | わずかに増加 |
| L_Knee | 46.99° | 48.95° | +1.96° | 増加 |
| R_Knee | 49.42° | 51.57° | +2.15° | 増加 |
| L_Shoulder | 54.41° | 52.42° | -1.99° | 減少 |
| R_Shoulder | 52.07° | 51.94° | -0.13° | ほぼ同等 |
| L_Hip | 55.34° | 57.78° | +2.44° | 増加 |
| R_Hip | 58.07° | 61.36° | +3.29° | 増加 |

### 考察
- **膝関節と股関節**: Y座標が高い方（Y=1.0.2.0）で最大誤差が増加傾向
- **肘関節**: 両グループでほぼ同等の精度
- **肩関節**: Y=1.0.2.0でわずかに改善

---

## 生成されたファイル

### 各ディレクトリ共通の生成ファイル

```
Y=0.5,1.5/
├── calculate_max_angle_error.py          # 実行スクリプト
├── coordinate_max_angle_error.csv        # 出力結果（288行）
├── max_angle_error_calculation.log       # 実行ログ
└── synced_joint_positions.csv            # Ground Truthデータ

Y=1.0.2.0/
├── calculate_max_angle_error.py          # 実行スクリプト
├── coordinate_max_angle_error.csv        # 出力結果（288行）
├── max_angle_error_calculation.log       # 実行ログ
└── synced_joint_positions.csv            # Ground Truthデータ
```

---

## CSVファイルの構造

### coordinate_max_angle_error.csv

**カラム構成**:
- `folder_name`: MediaPipeのCSVファイル名（例: CapturedFrames_-1.0_0.5_-3.0）
- `camera_x`: カメラのX座標
- `camera_y`: カメラのY座標
- `camera_z`: カメラのZ座標
- `L_Elbow`: 左肘の最大誤差（度）
- `R_Elbow`: 右肘の最大誤差（度）
- `L_Knee`: 左膝の最大誤差（度）
- `R_Knee`: 右膝の最大誤差（度）
- `L_Shoulder`: 左肩の最大誤差（度）
- `R_Shoulder`: 右肩の最大誤差（度）
- `L_Hip`: 左股関節の最大誤差（度）
- `R_Hip`: 右股関節の最大誤差（度）

**サンプル行**:
```csv
CapturedFrames_-1.0_0.5_-3.0,-1.0,0.5,-3.0,40.03,49.49,91.93,52.45,75.76,52.50,55.38,47.03
```

---

## 使用した関節定義

### ヒンジ関節（4関節）
- **L_Elbow（左肘）**: LeftUpperArm - LeftLowerArm - LeftHand
- **R_Elbow（右肘）**: RightUpperArm - RightLowerArm - RightHand
- **L_Knee（左膝）**: LeftUpperLeg - LeftLowerLeg - LeftFoot
- **R_Knee（右膝）**: RightUpperLeg - RightLowerLeg - RightFoot

### 複合関節（4関節）
- **L_Shoulder（左肩）**: Chest - LeftUpperArm - LeftLowerArm
- **R_Shoulder（右肩）**: Chest - RightUpperArm - RightLowerArm
- **L_Hip（左股関節）**: Hips - LeftUpperLeg - LeftLowerLeg
- **R_Hip（右股関節）**: Hips - RightUpperLeg - RightLowerLeg

---

## 実行環境

- **OS**: Windows 10
- **Python**: Python 3.x
- **必要なライブラリ**: pandas, numpy

---

## まとめ

✅ **総処理座標数**: 576座標（288×2ディレクトリ）  
✅ **処理時間**: 各ディレクトリ約10秒  
✅ **成功率**: 100%（全座標で正常に計算完了）

スクリプトは正常に動作し、各カメラ座標における最大角度誤差を正確に計算することができました。
MAEから最大誤差への変更により、各座標で最も大きな誤差が発生するフレームを特定できるようになりました。

